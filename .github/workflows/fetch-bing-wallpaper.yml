name: Fetch Bing Wallpaper Daily

on: 
  workflow_dispatch
#  schedule:
#    - cron: '15 2 * * *'

jobs:
  fetch-bing-wallpaper:
    runs-on: ubuntu-latest
    steps:
      - run: |
          echo "::group::üèÉ Runner start up"
          echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
          echo "üîé The branch name is ${{ github.ref }} and the repository is ${{ github.repository }}."
          echo "::endgroup::"
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip' # caching pip dependencies
      - name: Install dependencies and run script
        run: |
          python3 -m pip install --upgrade pip
          pip install requests
          pip install httpcore
          cd ${{ github.workspace }}/wallpaper
          python3 ./bing.py
      - name: Get commit message
        id: commit_msg
        run: |
          # $(date +'...') Usage: https://manpages.debian.org/bullseye/coreutils/date.1.en.html
          echo "message=Update by Github action $GITHUB_WORKFLOW on $(date +'%Y-%m-%d')" >> $GITHUB_OUTPUT
      - name: Commit changes and push
        uses: scapeville/action-git-add-all-then-commit-then-push@v1
        with:
          msg: "${{ steps.commit_msg.outputs.message }}"
        env:
          GH_TOKEN: ${{ github.token }}
      - run: echo "üçè This job's status is ${{ job.status }}."
